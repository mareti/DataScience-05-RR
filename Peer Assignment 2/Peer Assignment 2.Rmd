---
title: "Peer Assignment 2"
output: 
    html_document:
        keep_md: true
---
Muralidhar Areti  
Jul 24, 2015

## Synopsis
In this report we aim to assess the impact various types of storms have on population health and the economy. 

1. Which types of events are most harmful with respect to population health?  
2. Which types of events have the greatest economic consequences?  

To achieve these goals we need to provide the following results:  

* Assessment of data  
    - Number of records per year  
* Top 10 disaster types (overall or specific date range?) by  
    - Fatalities  
    - Injuries  
    - Property Damage  


## Data Processing


### Assumptions


### Initializing the Data

```{r 1.1 Initialize Environment}
library(tidyr)
suppressPackageStartupMessages(library(dplyr))
library(lubridate)
library(ggplot2)
library(scales)
```

```{r 1.2 Get Data, cache=TRUE}
url = "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(url, destfile="./data.csv.bz2", method="curl")
data = read.csv("data.csv.bz2")
```

```{r 1.3 Review Data}
print(dim(data))
print(names(data))
# print(str(data))
# print(summary(data))
# print(head(data))
```

```{r 1.4 Get Subset}
working_data = data %>%
    select(
        BGN_DATE
        , STATE
        , COUNTYNAME
        , EVTYPE
        , FATALITIES
        , INJURIES
        , PROPDMG
        ) %>%
    mutate(
        BGN_DATE = mdy_hms(BGN_DATE)
        , bgn_year = year(BGN_DATE)
        , bgn_month = month(BGN_DATE)
        ) %>%
    filter(year(BGN_DATE) >= 2000)

# head(working_data, 10)
```


## Results
```{r 2.1 Incidents per Year}
working_data %>% 
    group_by(bgn_year) %>%
    summarize(IncidentsPerYear = n()) %>%
    ggplot(aes(x=factor(bgn_year), y=IncidentsPerYear)) +
    geom_bar(fill="steelblue", stat="identity") + coord_flip() +
    geom_text(aes(label=format(IncidentsPerYear, format="d", big.mark=',')
                  , hjust=1)) +
    labs(x="Year of Incident") +
    labs(y="Number of Incidents") + 
    labs(title="Incidents per Year") +
    theme_bw() 
```

```{r 2.2 Injuries fatalities and property damage}
working_data %>%
    group_by(EVTYPE) %>%
    summarize(
        SumFatalities = sum(FATALITIES)
        , SumInjuries = sum(INJURIES)
        , SumFatInj = sum(FATALITIES) + sum(INJURIES)
        ) %>%
    top_n(10) %>% 
    arrange(desc(SumFatInj)) %>%
    gather(MeasureType, MeasureValue, SumFatalities:SumInjuries) %>%
    ggplot(aes(x=factor(EVTYPE), y=MeasureValue, fill=MeasureType)) + 
    geom_bar(stat="identity") + coord_flip() + 
    labs(x="Incident Type") + 
    labs(y="Measure Value") + 
    labs(title="Top 10 Incidents by Injuries and Fatalities") +
    theme_bw()
```

```{r 2.3 Yearly Property Damage Trend}
top_pd = working_data %>%
    group_by(EVTYPE) %>%
    summarize(SumPropertyDamage = sum(PROPDMG)) %>%
    top_n(5) %>% 
    arrange(desc(SumPropertyDamage)) %>%
    select(EVTYPE)

sub_data = inner_join(x=working_data, y=top_pd)

sub_data %>% 
    group_by(bgn_year, EVTYPE) %>%
    summarize(SumPropertyDamage = sum(PROPDMG)) %>%
    ggplot(aes(x=factor(bgn_year), y=SumPropertyDamage, fill=EVTYPE)) + 
    geom_bar(stat="identity") + 
    scale_y_continuous(labels=dollar) +
    scale_fill_brewer() +
    labs(x="Incident Year") + 
    labs(y="Measure Value") + 
    labs(title="Property Damage of the 5 Most Damaging Incidents") +
    theme_bw() +
    theme(axis.text.x = element_text(angle=90, size=10))
```

## Conclusion


End of File